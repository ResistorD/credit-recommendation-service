# Credit Recommendation Service

## Краткое описание проекта

Проект представляет собой сервис персонализированных рекомендаций банковских продуктов для клиентов банка «Стар».  
Сервис анализирует транзакции пользователей и выдает рекомендации по продуктам банка (депозитные счета, инвестиции, кредиты и т.д.) через REST API и Telegram-бота.

**Стек технологий:** Java 17, Spring Boot, JDBC / JdbcTemplate, H2 Embedded Database, Maven, JUnit, Mockito.  
**Команда:** Дубов Дмитрий, Гущин Дмитрий, Хакимов Тимур.

Проект реализует MVP системы рекомендаций, учитывая статические и динамические правила продуктов. Правила проверяются на основе данных о пользователях, их транзакциях и продуктах банка.

---

## Функциональные возможности

Сервис предоставляет REST API для получения рекомендаций по пользователю:

**GET /recommendation/<user_id>**  
Response:
```json
{
  "user_id": "<user_id>",
  "recommendations": [
    {
      "id": "<product_id>",
      "name": "<product_name>",
      "text": "<product_description>"
    }
  ]
}
```

Если для пользователя нет подходящих рекомендаций, массив `recommendations` возвращается пустым.

Также есть интеграция с Telegram-ботом, который позволяет пользователям получать рекомендации через чат.

Сервис поддерживает управление правилами через API и статистику применения правил, что позволяет отслеживать эффективность рекомендаций и при необходимости добавлять новые продукты или правила.

---

## Архитектура и компоненты

Сервис построен на Spring Boot и использует JdbcTemplate для работы с базой данных H2. Основные компоненты:

- **RecommendationService** — основной сервис для вычисления и выдачи рекомендаций пользователю.
- **RecommendationRuleSet** — интерфейс для реализации наборов правил для продукта.
- **DebtInvestSavingsRule** — пример конкретного набора правил, который проверяет транзакции пользователя.
- **Repositories** — слой доступа к данным (транзакции, продукты, статистика правил).
- **Controllers** — обработка REST-запросов и управление правилами.
- **Telegram Bot** — интеграция с пользователями через чат.

Система построена так, чтобы новые правила и продукты легко добавлялись через реализацию интерфейсов и регистрацию компонентов в Spring.

### Диаграмма компонентов (Component Diagram)
```
[Client / Telegram] ---> [Controllers] ---> [RecommendationService] ---> [Repositories] ---> [H2 Database]
[Management API] ---> [RuleController] ---> [RuleService] ---> [RuleStatsRepository]
```

### Диаграмма активности (Activity Diagram) - выдача рекомендаций
```
Start -> Получить user_id -> Для каждого продукта: Проверить правила ->
[Подходит?] -> Да: добавить в recommendations -> Нет: пропустить -> End
```

---

## REST API

Сервис предоставляет следующие основные эндпоинты:

- **GET /recommendation/{user_id}** — получить рекомендации для пользователя.
- **GET /management/info — информация о состоянии приложения.
- **POST /rules** — добавить или изменить динамическое правило.
- **GET /rule-stats** — получить статистику работы правил.
- **POST /management/clear-caches — очистить кэши.

Документация API формата OpenAPI (Swagger) создается отдельно для удобства интеграторов и разработчиков.

---

## Развертывание

### Требования

- Java 17
- Maven
- H2 Database (встроенная)
- Переменные окружения для Spring Boot:
    - `APPLICATION_NAME` — имя приложения
    - `SERVER_PORT` — порт сервера
    - `SPRING_DATASOURCE_URL` — URL базы данных H2
    - `SPRING_DATASOURCE_USERNAME` — имя пользователя базы
    - `SPRING_DATASOURCE_PASSWORD` — пароль базы (если есть)

### Сборка

```bash
mvn clean package
```

### Запуск

```bash
java -jar target/credit-recommendation-0.0.1-SNAPSHOT.jar
```

Приложение будет доступно по адресу `http://localhost:<SERVER_PORT>/`.

---

## User Stories и требования

| ID | User Story / NFR | Описание |
|----|-----------------|----------|
| US1 | Как пользователь, я хочу получать рекомендации по продуктам, чтобы выбирать подходящие | Пользователь получает рекомендации через API или Telegram |
| US2 | Как менеджер, я хочу управлять динамическими правилами, чтобы обновлять логику рекомендаций | Возможность добавлять, изменять правила через API |
| US3 | Как внешняя система, я хочу сбрасывать кеш и собирать статистику | API для интеграции с внешними сервисами |
| NFR1 | Производительность | Запросы к базе должны быть оптимизированы для быстрого расчета рекомендаций |
| NFR2 | Масштабируемость | Новые правила и продукты должны добавляться без изменения существующего кода |

---

## Таблица трейсинга требований

| Требование | Связанный Issue / Branch |
|------------|--------------------------|
| US1 | issue #1 / branch: feature/recommendation-api | 
| US2 | issue #2 / branch: feature/rule-management |
| US3 | issue #3 / branch: feature/cache-stats |
| NFR1 | issue #4 / branch: feature/sql-optimization |
| NFR2 | issue #5 / branch: feature/add-new-rules |

---

## Добавление нового правила

1. Создать новый класс, реализующий интерфейс `RecommendationRuleSet`.
2. Реализовать метод проверки правил для пользователя.
3. Аннотировать класс `@Component`, чтобы Spring автоматически зарегистрировал его.
4. При необходимости добавить запись о правиле в `RuleRepository` и настроить динамическую статистику.
5. Тестировать новый набор правил с использованием JUnit и Mockito.

---

## Структура проекта

```
credit-recommendation/
├── src/main/java/ru/skypro/recommendation/...
├── src/main/resources/
│   ├── application.properties
│   └── schema.sql
├── src/test/java/ru/skypro/recommendation/...
├── pom.xml
├── README.md
```

---

## Команда и процесс

Командный проект. 
Использовались Git и GitHub для контроля версий, веток и merge requests.

